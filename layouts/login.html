<div class="rbt-elements-area bg-color-white rbt-section-gap">
  <div class="container">
    <div class="row gy-5 row--30">

      <div class="col-lg-6">
        <div class="rbt-contact-form contact-form-style-1 max-width-auto">
          <h3 class="title">Login</h3>
          <form class="max-width-auto">
            <div class="form-group">
              <input class="con_name" name="con_name" type="text" />
              <label>Username or email *</label>
              <span class="focus-border"></span>
            </div>
            <div class="form-group">
              <input class="con_password" name="con_password" type="password">
              <label>Password *</label>
              <span class="focus-border"></span>
            </div>

            <div class="form-submit-group">
              <button type="button" onclick="postLogin()" class="rbt-btn btn-md btn-gradient hover-icon-reverse w-100">
                <span class="icon-reverse-wrapper">
                  <span class="btn-text">Log In</span>
                  <span class="btn-icon"><i class="feather-arrow-right"></i></span>
                  <span class="btn-icon"><i class="feather-arrow-right"></i></span>
                </span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="rbt-contact-form contact-form-style-1 max-width-auto">
          <h3 class="title">Register</h3>
          <form class="max-width-auto">
            <div class="form-group">
              <input id="reg-email" name="register-email" type="text" />
              <label>Email address *</label>
              <span class="focus-border"></span>
            </div>

            <div class="form-group">
              <input id="reg-fullname" name="register_user" type="text">
              <label>Full Name *</label>
              <span class="focus-border"></span>
            </div>

            <div class="form-group">
              <input id="reg-username" name="register_user" type="text">
              <label>Username *</label>
              <span class="focus-border"></span>
            </div>

            <div class="form-group">
              <input id="reg-password" name="register_password" type="password">
              <label>Password *</label>
              <span class="focus-border"></span>
            </div>

            <div class="form-group">
              <input id="reg-conpassword" name="register_conpassword" type="password">
              <label>Confirm Password *</label>
              <span class="focus-border"></span>
            </div>

            <div class="form-submit-group">
              <button type="button" onclick="postRegister()"
                class="rbt-btn btn-md btn-gradient hover-icon-reverse w-100">
                <span class="icon-reverse-wrapper">
                  <span class="btn-text">Register</span>
                  <span class="btn-icon"><i class="feather-arrow-right"></i></span>
                  <span class="btn-icon"><i class="feather-arrow-right"></i></span>
                </span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  function postLogin() {
    const payload = {
      username: $(".con_name").val(),
      password: $(".con_password").val(),
    }

    fetch("http://localhost:8080/auth/login", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(payload),
    })
      .then(response => {
        return response.json();
      })
      .then(data => {
        if (data.statusCode === 200) {
          localStorage.setItem("token", data.data.token);
          localStorage.setItem("role", data.data.role);
          localStorage.setItem("name", data.data.name);

          Swal.fire({
            position: "top-end",
            icon: "success",
            title: "Login success",
            showConfirmButton: false,
            timer: 1500
          });

          $(".con_name").val("")
          $(".con_password").val("")

          if (data.data.role === "admin") {
            $("#layouts-content").load("/layouts/instructor/index.html");
          } else {
            $("#layouts-content").load("/layouts/student/index.html");
          }
        } else {
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: data.errors[0],
          });
        }
      });
  }

  function postRegister() {
    const payload = {
      email: $("#reg-email").val(),
      fullName: $("#reg-fullname").val(),
      username: $("#reg-username").val(),
      password: $("#reg-password").val(),
      conPassword: $("#reg-conpassword").val(),
    }

    if (payload.password !== payload.conPassword) {
      Swal.fire({
        icon: "error",
        title: "Oops...",
        text: "Password not match",
      });
      return;
    }

    fetch("http://localhost:8080/users/register", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(payload),
    })
      .then(response => {
        return response.json();
      })
      .then(data => {
        if (data?.statusCode === 200) {
          Swal.fire({
            position: "top-end",
            icon: "success",
            title: "Register success please check your email",
            showConfirmButton: false,
            timer: 1500
          });

          $("#reg-email").val("")
          $("#reg-fullname").val("")
          $("#reg-username").val("")
          $("#reg-password").val("")
          $("#reg-conpassword").val("")

          setTimeout(() => {
            window.location.reload();
          });
        } else {
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: data.errors[0],
          });
        }
      });
  }
</script>